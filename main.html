<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="stylesheet" href="styles.css">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Text Editor with Vim Keybindings</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.4.12/ace.js" integrity="sha512-GZ1RIgZaSc8rnco/8CXfRdCpDxRCphenIiZ2ztLy3XQfCbQUSCuk8IudvNHxkRA3oUg6q0qejgN/qqyG1duv5Q==" crossorigin="anonymous"></script>
</head>
<body>
    
    <div id="editor"></div>
    <script>
        const editor = ace.edit("editor");
        editor.setTheme("ace/theme/monokai");
        editor.session.setMode("ace/mode/text");
        editor.setKeyboardHandler("ace/keyboard/vim");
        editor.renderer.setShowGutter(false);
        
        editor.setOptions({
            showInvisibles: false, // Disable display of invisible characters
            tabSize: 4,
            printMargin: false,
            fontSize: 24,
            indentedSoftWrap: false,
            wrap: "free",
            fontFamily: 'iawriter'
        })

        ace.config.loadModule("ace/keybinding/vim", function() { // Use Vim Here
            Vim = require("ace/keyboard/vim").Vim
            Vim.map("j", "gj", "normal")
            Vim.map("k", "gk", "normal")
        }) 

        function saveText() {
            const text = editor.getValue();
            localStorage.setItem('savedText', text);
        }

        function loadText() {
            const savedText = localStorage.getItem('savedText');
            if (savedText) {
                editor.setValue(savedText);
            }
        }

    // Add an event listener to load the saved text when the DOM is fully loaded
    document.addEventListener('DOMContentLoaded', loadText);
    // Add an event listener to save the text in the editor whenever it changes
    editor.on('change', saveText);

    async function saveToGitHub() {
    const text = editor.getValue(); // Replace this with the method to get the text from your editor
    const token = 'your_personal_access_token'; // Replace this with your actual token
    const owner = 'your_github_username'; // Replace this with your GitHub username
    const repo = 'your_repo_name'; // Replace this with the name of the repo you want to save the text to
    const path = 'your_file_name.txt'; // Replace this with the desired file name

    const url = `https://api.github.com/repos/${owner}/${repo}/contents/${path}`;

    // Get the current file content from the repo
    const response = await fetch(url, {
        headers: {
            'Authorization': `token ${token}`,
            'Accept': 'application/vnd.github+json'
        }
    });

    const data = await response.json();

    // Update the file content in the repo
    const updateResponse = await fetch(url, {
        method: 'PUT',
        headers: {
            'Authorization': `token ${token}`,
            'Accept': 'application/vnd.github+json'
        },
        body: JSON.stringify({
            message: 'Update file content',
            content: btoa(text),
            sha: data.sha
        })
    });

    const updateData = await updateResponse.json();

    if (updateResponse.ok) {
        console.log('File saved successfully:', updateData);
    } else {
        console.error('Error saving file:', updateData);
    }
    }

// Menu class definition
class Menu {
    constructor(items) {
        this.items = items;
        this.menuElement = document.createElement('div');

        const searchBox = document.createElement('input');
        searchBox.type = 'text';
        searchBox.placeholder = 'Search for options...';
        searchBox.style.width = '100%';
        searchBox.style.padding = '5px 10px';
        searchBox.style.marginBottom = '10px';
        searchBox.addEventListener('input', () => this.filterItems(searchBox.value));
    
        searchBox.addEventListener('keydown', (event) => 
        {
            if (event.code === 'Enter') {
                const visibleItemCount = menu.visibleItemCount(searchText);            
                if (visibleItemCount.length === 1) {
                    visibleItems[0].action();
                }
            }
        });

        this.menuElement.appendChild(searchBox);

        this.listElement = document.createElement('ul');
        this.listElement.style.listStyleType = 'none';
        this.listElement.style.padding = '0';
        this.listElement.style.margin = '0';
        this.menuElement.appendChild(this.listElement);

        items.forEach(item => this.createItem(item));
    }


    createItem(item) {
        const listItem = document.createElement('li');
        listItem.style.display = 'block';
        listItem.style.padding = '5px 10px';
        listItem.style.cursor = 'pointer';
        listItem.textContent = item.text;
        listItem.addEventListener('click', item.action);
        this.listElement.appendChild(listItem);
    }

    visibleItems(searchText) {
        return this.items.filter(item => item.name.toLowerCase().includes(searchText.toLowerCase()));
    }

    visibleItemCount(searchText) {
        const filteredItems = this.visibleItems(searchText);
        return filteredItems.length;
    }


    filterItems(searchText) {
        this.listElement.innerHTML = '';
        this.items
            .filter(item => item.text.toLowerCase().includes(searchText.toLowerCase()))
            .forEach(item => this.createItem(item));
    }



    attachTo(element) {
        element.appendChild(this.menuElement);
    }
}

        
// GitInfo class definition
class GitInfo {
// Function to create the gitInfoMenu as a div centered on the palette
    
    constructor() {
        this.element = document.createElement('div');
        this.element.id = 'git-info'; 
        this.createInput('GitHub Username', 'username');
        this.createInput('GitHub Token', 'token');
        this.createInput('Repository Name', 'repo');
        this.createInput('File Name', 'filename');
        const saveButton = document.createElement('button');
        saveButton.textContent = 'Save';
        saveButton.addEventListener('click', () => this.saveCredentials());
        this.element.appendChild(saveButton);
    }

    createInput(labelText, storageKey) {
        const label = document.createElement('label');
        label.textContent = labelText;
        this.element.appendChild(label);

        const input = document.createElement('input');
        input.type = 'text';
        input.value = localStorage.getItem(storageKey) || '';
        input.addEventListener('input', () => localStorage.setItem(storageKey, input.value));
        this.element.appendChild(input);
    }

    saveCredentials() {
        // Save the credentials to localStorage
        const username = localStorage.getItem('username');
        const token = localStorage.getItem('token');
        const repo = localStorage.getItem('repo');
        const filename = localStorage.getItem('filename');

        // Call the saveToGitHub function with the saved credentials
        saveToGitHub(username, token, repo, filename);
    }

    attachTo(element) {
        element.appendChild(this.element);
    }

}

// Instantiate the GitInfo class
const gitInfo = new GitInfo();

// Modify the menuItems array to include the gitInfo element
const menuItems = [
    {
        text: 'save to git repo',
        action: () => {
                gitInfo.saveCredentials();
        }
    },
    {
        text: 'add your git info',
        action: () => {
// Create the GitInfoMenu as a child of the palette
        gitInfo.attachTo(palette.element);
    }

           
    },
];
        
const menu = new Menu(menuItems);


// CommandPalette class definition
class CommandPalette {
    constructor() {
        this.isOpen = false;
        this.element = null;
    }

    open() {
        if (!this.isOpen) {

            

        // Create the overlay element
            this.overlay = document.createElement('div');
            this.overlay.style.position = 'fixed';
            this.overlay.style.top = '0';
            this.overlay.style.left = '0';
            this.overlay.style.width = '100%';
            this.overlay.style.height = '100%';
            this.overlay.style.backgroundColor = 'rgba(0, 0, 0, 0.5)';
            this.overlay.style.backdropFilter = 'blur(5px)';
            this.overlay.style.zIndex = '999';
            document.body.appendChild(this.overlay);
        //make the box
            this.element = document.createElement('div');
            this.element.id = 'command-palette';
            this.element.style.position = 'fixed';
            this.element.style.top = '50%';
            this.element.style.left = '50%';
            this.element.style.transform = 'translate(-50%, -50%)';
            this.element.style.zIndex = '1000';
            this.element.style.backgroundColor = 'white';
            this.element.style.border = '2px solid black';
        // Add border-radius to make the border rounded at the corners
            this.element.style.borderRadius = '10px';
            this.element.style.padding = '10px';
            this.element.style.width = '30vw';
            this.element.style.height = '30vh';
        // Enable vertical scrolling if the content overflows the element's height
            this.element.style.overflowY = 'auto';
            
             document.body.appendChild(this.element);
        // Add the menu to the command palette
            this.element.appendChild(menu.menuElement);
            
            this.isOpen = true;
        }
    }

    close() {
        if (this.isOpen) {
            document.body.removeChild(this.overlay);
            document.body.removeChild(this.element);
            this.isOpen = false;
        }
    }
}

// Instantiate the CommandPalette class
const palette = new CommandPalette();

// Add an event listener for keydown events
document.addEventListener('keydown', (event) => {
    // Check if the cmd+space keys are pressed
    if ((event.metaKey || event.ctrlKey) && event.code === 'Space') {
    if (palette.isOpen) {
        palette.close();
    } else {
        palette.open();
    }
   // Check if the 'esc' key is pressed
    if (event.code === 'Escape') {
        palette.close();
    }
   
}

});

    </script>
</body>
</html>
    