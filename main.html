<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="stylesheet" href="styles.css">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Text Editor with Vim Keybindings</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.4.12/ace.js" integrity="sha512-GZ1RIgZaSc8rnco/8CXfRdCpDxRCphenIiZ2ztLy3XQfCbQUSCuk8IudvNHxkRA3oUg6q0qejgN/qqyG1duv5Q==" crossorigin="anonymous"></script>
</head>
<body>
    
    <div id="editor"></div>
    <script>
        const editor = ace.edit("editor");
        editor.setTheme("ace/theme/monokai");
        editor.session.setMode("ace/mode/text");
        editor.setKeyboardHandler("ace/keyboard/vim");
        editor.renderer.setShowGutter(false);
        
        editor.setOptions({
            showInvisibles: false, // Disable display of invisible characters
            tabSize: 4,
            printMargin: false,
            fontSize: 24,
            indentedSoftWrap: false,
            wrap: "free",
            fontFamily: 'iawriter'
        })

        ace.config.loadModule("ace/keybinding/vim", function() { // Use Vim Here
            Vim = require("ace/keyboard/vim").Vim
            Vim.map("j", "gj", "normal")
            Vim.map("k", "gk", "normal")
        }) 

        function saveText() {
            const text = editor.getValue();
            localStorage.setItem('savedText', text);
        }

        function loadText() {
            const savedText = localStorage.getItem('savedText');
            if (savedText) {
                editor.setValue(savedText);
            }
        }

    // Add an event listener to load the saved text when the DOM is fully loaded
    document.addEventListener('DOMContentLoaded', loadText);
    // Add an event listener to save the text in the editor whenever it changes
    editor.on('change', saveText);

    async function saveToGitHub() {
    const text = editor.getValue(); // Replace this with the method to get the text from your editor
    const token = 'your_personal_access_token'; // Replace this with your actual token
    const owner = 'your_github_username'; // Replace this with your GitHub username
    const repo = 'your_repo_name'; // Replace this with the name of the repo you want to save the text to
    const path = 'your_file_name.txt'; // Replace this with the desired file name

    const url = `https://api.github.com/repos/${owner}/${repo}/contents/${path}`;

    // Get the current file content from the repo
    const response = await fetch(url, {
        headers: {
            'Authorization': `token ${token}`,
            'Accept': 'application/vnd.github+json'
        }
    });

    const data = await response.json();

    // Update the file content in the repo
    const updateResponse = await fetch(url, {
        method: 'PUT',
        headers: {
            'Authorization': `token ${token}`,
            'Accept': 'application/vnd.github+json'
        },
        body: JSON.stringify({
            message: 'Update file content',
            content: btoa(text),
            sha: data.sha
        })
    });

    const updateData = await updateResponse.json();

    if (updateResponse.ok) {
        console.log('File saved successfully:', updateData);
    } else {
        console.error('Error saving file:', updateData);
    }
    }



// CommandPalette class definition
class CommandPalette {
    constructor() {
        this.isOpen = false;
        this.element = null;
    }

    open() {
        if (!this.isOpen) {
            this.element = document.createElement('div');
            this.element.id = 'command-palette';
            this.element.style.position = 'fixed';
            this.element.style.top = '50%';
            this.element.style.left = '50%';
            this.element.style.transform = 'translate(-50%, -50%)';
            this.element.style.zIndex = '1000';
            this.element.style.backgroundColor = 'black';
            this.element.style.border = '4px solid black';
            this.element.style.padding = '10px';
            this.element.style.width = '30vw';
            this.element.style.height = '30vh';
            this.element.style.overflowY = 'auto';

            document.body.appendChild(this.element);
            this.isOpen = true;
        }
    }

    close() {
        if (this.isOpen) {
            document.body.removeChild(this.element);
            this.isOpen = false;
        }
    }
}

// Instantiate the CommandPalette class
const palette = new CommandPalette();

// Add an event listener for keydown events
document.addEventListener('keydown', (event) => {
    // Check if the cmd+space keys are pressed
    if ((event.metaKey || event.ctrlKey) && event.code === 'Space') {
    if (palette.isOpen) {
        palette.close();
    } else {
        palette.open();
    }
    if (event.code === 'esc') {
        palette.close();
    }
}

});

    </script>
</body>
</html>
    